# Gestor de Tareas - Ejemplo End-to-End en Ãguila
# Demuestra: Clases, MÃ³dulos (fs, json), Listas, Diccionarios, Input de Usuario

archivo_db = "tareas.json"

clase Tarea {
    id: Numero
    titulo: Texto
    completada: Logico

    constructor(id, titulo, completada) {
        this.id = id
        this.titulo = titulo
        this.completada = completada
    }

    a_diccionario() {
        retornar {
            "id": this.id,
            "titulo": this.titulo,
            "completada": this.completada
        }
    }
    
    marcar_completada() {
        this.completada = verdadero
    }
}

clase Gestor {
    tareas: Lista

    constructor() {
        this.tareas = []
        this.cargar()
    }

    cargar() {
        intentar {
            contenido = fs.leer(archivo_db)
            datos = json.parsear(contenido)
            
            # Convertir diccionarios a objetos Tarea
            para d en datos {
                t = nuevo Tarea(d["id"], d["titulo"], d["completada"])
                this.tareas.agregar(t)
            }
            imprimir "ğŸ“‚ Tareas cargadas: " + this.tareas.longitud()
        } capturar error {
            imprimir "â„¹ï¸ No se encontrÃ³ base de datos previa. Iniciando nueva."
            this.tareas = []
        }
    }

    guardar() {
        datos = []
        para t en this.tareas {
            datos.agregar(t.a_diccionario())
        }
        texto_json = json.stringificar(datos)
        fs.escribir(archivo_db, texto_json)
        imprimir "ğŸ’¾ Cambios guardados."
    }

    agregar_tarea(titulo) {
        id = this.tareas.longitud() + 1
        t = nuevo Tarea(id, titulo, falso)
        this.tareas.agregar(t)
        this.guardar()
        imprimir "âœ… Tarea agregada: " + titulo
    }

    listar_tareas() {
        imprimir "\n--- LISTA DE TAREAS ---"
        si this.tareas.longitud() == 0 {
            imprimir "(No hay tareas)"
        }
        
        para t en this.tareas {
            estado = "[ ]"
            si t.completada { estado = "[X]" }
            imprimir estado + " " + t.id + ". " + t.titulo
        }
        imprimir "-----------------------"
    }

    completar_tarea(id) {
        encontrada = falso
        para t en this.tareas {
            si t.id == id {
                t.marcar_completada()
                encontrada = verdadero
            }
        }
        
        si encontrada {
            this.guardar()
            imprimir "ğŸ‰ Tarea " + id + " completada."
        } sino {
            imprimir "âŒ Tarea no encontrada."
        }
    }
}

# --- Programa Principal ---

gestor = nuevo Gestor()
corriendo = verdadero

mientras corriendo {
    imprimir "\nOPCIONES:"
    imprimir "1. Ver tareas"
    imprimir "2. Agregar tarea"
    imprimir "3. Completar tarea"
    imprimir "4. Salir"
    
    opcion = leer("Selecciona una opciÃ³n: ")
    
    segun opcion {
        caso 1 {
            gestor.listar_tareas()
        }
        caso 2 {
            titulo = leer("TÃ­tulo de la tarea: ")
            gestor.agregar_tarea(titulo)
        }
        caso 3 {
            id = leer("ID de la tarea a completar: ")
            gestor.completar_tarea(id)
        }
        caso 4 {
            imprimir "Â¡Hasta luego!"
            corriendo = falso
        }
        defecto {
            imprimir "OpciÃ³n no vÃ¡lida."
        }
    }
}
